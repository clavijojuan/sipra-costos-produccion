<p-button label="Regresar" (click)="back()" />


<div *ngIf="categoria; else newElement" class="flex justify-content-between align-items-center">
    <h3> {{ mode() === 'edit' ? 'Editar': 'Consultar' }} categoria: {{ categoria.id }} </h3>
    <p-button *ngIf="mode() === 'edit'" label="Actualizar" (click)="update()" [disabled]="!form.valid" />
</div>

<ng-template #newElement>
    <div class="flex justify-content-between align-items-center">
        <h3> Crear categoria </h3>

        <div class="flex flex-direction-column gap-2">
            <p-button *ngIf="mode() === 'new'" label="Reiniciar" (click)="reset()" [disabled]="!form.valid" />
            <p-button *ngIf="mode() === 'new'" label="Guardar" (click)="create()" [disabled]="!form.valid" />
        </div>
    </div>
</ng-template>

<form [formGroup]="form">
    <div class="grid">
        <div *ngIf="mode() !== 'new'" class="col-2 flex flex-column gap-2">
            <label for="id">Código</label>
            <p-inputNumber formControlName="id" />
        </div>

        <div class="col-6 flex flex-column gap-2">
            <label for="labelCategorias">Nombre</label>
            <input type="text" pInputText formControlName="labelCategorias" />
        </div>
    </div>

    <h4> Subcategorias </h4>

    <div *ngIf="mode() === 'edit' || mode() === 'new'; else tabla">

        <ng-container formArrayName="categorias">
            <p-scrollPanel [style]="{ width: '100%', height: '400px' }" styleClass="custombar1">
                <div *ngFor="let formGroup of categoriasFormArray!.controls; let i = index">
                    <div class="grid mt-2" [formGroup]="formGroup">
                        <div class="col-1 flex flex-column justify-content-center align-items-center">
                            <span></span>
                            <p-button class="mt-4" icon="pi pi-times" [rounded]="true" [text]="true" severity="warning"
                                (click)="deleteSubcategory( i )" />
                        </div>
                        <div class="col-1 flex flex-column gap-2">
                            <label for="id">Código</label>
                            <p-inputNumber formControlName="id" />
                        </div>
                        <div class="col-4 flex flex-column gap-2">
                            <label for="nombre">Nombre</label>
                            <input type="text" pInputText formControlName="nombre" />
                        </div>
                        <div class="col-1 flex flex-column gap-2">
                            <label for="order">Orden</label>
                            <p-inputNumber formControlName="order" />
                        </div>
                        <div class="col-4 flex flex-column gap-2">
                            <label for="valor">Valor</label>
                            <input type="text" pInputText formControlName="valor" />
                        </div>
                        <div class="col-1 flex flex-column gap-2">
                            <label for="color">Color</label>
                            <p-colorPicker appendTo="body" formControlName="color" />
                        </div>
                    </div>
                </div>
            </p-scrollPanel>


            <p-button label="Agregar subcategoria" class="mt-2" (click)="addSubCategory()" />

        </ng-container>

    </div>

    <ng-template #tabla>
        <app-tablas [titulos]="titulos" [datos]="datos" [accionEditar]="mode() === 'edit'"></app-tablas>
    </ng-template>

</form>